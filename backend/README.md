# Backend API - Laravel

Laravel-based RESTful API backend for Portfolio Website, providing authentication, content management, and data delivery. Fully RESTful with Sanctum authentication, comprehensive validation, and API resources.

## ğŸ—ï¸ Architecture

This backend follows Laravel best practices with:

- **MVC Pattern**: Models, Controllers, and Requests
- **API Resources**: Clean JSON transformations
- **Form Requests**: Centralized validation
- **Middleware**: Authentication, CORS, rate limiting
- **RESTful Design**: Standard HTTP methods and status codes
- **Traits**: Reusable functionality (HasSeoFields, HasSlug, SoftDeletes)

## ğŸš€ Tech Stack

- **Runtime**: PHP 8.2+
- **Framework**: Laravel 10.x
- **Authentication**: Laravel Sanctum (JWT-style tokens)
- **Database**: MySQL 8.0 (via XAMPP)
- **ORM**: Eloquent (Laravel's built-in ORM)
- **Validation**: Laravel Form Requests
- **File Upload**: Laravel Storage + local filesystem
- **Email**: Laravel Mail + SMTP
- **Testing**: Pest PHP / PHPUnit
- **API Documentation**: Laravel API Resources

## ğŸ“‹ Prerequisites

- PHP 8.2 or higher
- Composer 2.x
- MySQL 8.0 (via XAMPP port 3306)
- Apache (via XAMPP port 80)

## ğŸ› ï¸ Installation

### 1. Install Dependencies

```bash
cd backend
composer install
```

### 2. Environment Configuration

```bash
copy .env.example .env
```

Edit `.env`:

```env
APP_NAME="Portfolio V2"
APP_ENV=local
APP_KEY=base64:... # Generated by php artisan key:generate
APP_DEBUG=true
APP_URL=http://localhost/Portfolio_v2/backend/public

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=portfolio_v2
DB_USERNAME=ali
DB_PASSWORD=aL1889900@@@

MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@portfolio.test
```

### 3. Generate Application Key

```bash
php artisan key:generate
```

### 4. Database Setup

```bash
# Run migrations
php artisan migrate

# Seed with sample data
php artisan db:seed
```

### 5. Storage Link

```bash
php artisan storage:link
```

## ğŸš¦ Running the Server

### XAMPP Setup (Required)

**IMPORTANT:** Uses XAMPP Apache (Port 80), **NOT** `php artisan serve`

1. **Start XAMPP Control Panel**
   - Start Apache (Port 80)
   - Start MySQL (Port 3306)

2. **Access the API**
   - **Base URL**: http://localhost/Portfolio_v2/backend/public/api
   - **PHPMyAdmin**: http://localhost/phpmyadmin

## ğŸ“ Project Structure

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/Api/    # API controllers (6/9 complete)
â”‚   â”‚   â”œâ”€â”€ Requests/           # Form validation (10+ request classes)
â”‚   â”‚   â””â”€â”€ Resources/          # API transformers (6+ resources)
â”‚   â”œâ”€â”€ Models/                 # Eloquent models (8 models)
â”‚   â”‚   â”œâ”€â”€ User.php
â”‚   â”‚   â”œâ”€â”€ Post.php           # HasSeoFields, SoftDeletes, HasSlug
â”‚   â”‚   â”œâ”€â”€ Project.php        # HasSeoFields, SoftDeletes, HasSlug
â”‚   â”‚   â”œâ”€â”€ Category.php       # HasSeoFields, HasSlug
â”‚   â”‚   â”œâ”€â”€ Award.php
â”‚   â”‚   â”œâ”€â”€ Gallery.php
â”‚   â”‚   â”œâ”€â”€ Testimonial.php
â”‚   â”‚   â”œâ”€â”€ Contact.php
â”‚   â”‚   â”œâ”€â”€ Setting.php
â”‚   â”‚   â””â”€â”€ Service.php
â”‚   â”œâ”€â”€ Traits/
â”‚   â”‚   â”œâ”€â”€ HasSeoFields.php   # SEO functionality
â”‚   â”‚   â””â”€â”€ HasSlug.php        # Slug generation
â”‚   â””â”€â”€ Helpers/               # Helper functions
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/            # 17 migrations (100%)
â”‚   â””â”€â”€ seeders/               # 13 seeders (100%)
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.php
â”‚   â”œâ”€â”€ uploads/               # Upload directory
â”‚   â””â”€â”€ .htaccess
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ api.php               # 40+ API endpoints
â”‚   â””â”€â”€ web.php
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ app/uploads/          # Uploaded files
â”‚   â””â”€â”€ logs/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Feature/              # Feature tests
â”‚   â””â”€â”€ Unit/                 # Unit tests
â”œâ”€â”€ .env                      # Environment config
â”œâ”€â”€ composer.json
â””â”€â”€ artisan
```

## ğŸ” Environment Variables

```env
# Application
APP_NAME=Portfolio_V2
APP_ENV=local
APP_KEY=base64:...
APP_DEBUG=true
APP_URL=http://localhost/Portfolio_v2/backend/public

# Database
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=portfolio_v2
DB_USERNAME=ali
DB_PASSWORD=aL1889900@@@

# Sanctum
SANCTUM_STATEFUL_DOMAINS=localhost:5173,127.0.0.1

# Mail
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@portfolio.test

# File Upload
MAX_UPLOAD_SIZE=5242880  # 5MB in bytes
```

## ğŸ“¡ API Endpoints (40+)

### Authentication (3 endpoints)
```
POST   /api/auth/login         # Login user
POST   /api/auth/register      # Register user
POST   /api/auth/logout        # Logout (auth required)
GET    /api/auth/me            # Get current user
```

### Admin Projects (5 endpoints)
```
GET    /api/admin/projects     # List all projects
GET    /api/admin/projects/:id # Get project by ID
POST   /api/admin/projects     # Create project
PUT    /api/admin/projects/:id # Update project
DELETE /api/admin/projects/:id # Delete project
```

### Admin Posts (5 endpoints)
```
GET    /api/admin/posts        # List all posts (admin view)
GET    /api/admin/posts/:id    # Get post by ID
POST   /api/admin/posts        # Create post
PUT    /api/admin/posts/:id    # Update post
DELETE /api/admin/posts/:id    # Delete post
```

### Admin Categories (5 endpoints)
```
GET    /api/admin/categories   # List all categories
GET    /api/admin/categories/:id # Get category by ID
POST   /api/admin/categories   # Create category
PUT    /api/admin/categories/:id # Update category
DELETE /api/admin/categories/:id # Delete category
```

### Admin Awards (8 endpoints)
```
GET    /api/admin/awards       # List all awards
GET    /api/admin/awards/:id   # Get award by ID
POST   /api/admin/awards       # Create award
PUT    /api/admin/awards/:id   # Update award
DELETE /api/admin/awards/:id   # Delete award
POST   /api/admin/awards/:id/galleries     # Link gallery
DELETE /api/admin/awards/:id/galleries/:gid # Unlink gallery
PUT    /api/admin/awards/:id/galleries/reorder # Reorder galleries
```

### Admin Gallery (7 endpoints)
```
GET    /api/admin/gallery      # List galleries
GET    /api/admin/gallery/:id  # Get gallery by ID
POST   /api/admin/gallery      # Create gallery
POST   /api/admin/gallery/bulk-upload # Bulk upload (up to 20)
PUT    /api/admin/gallery/:id  # Update gallery
DELETE /api/admin/gallery/:id  # Delete gallery
POST   /api/admin/gallery/bulk-delete # Bulk delete
```

### Admin Testimonials (5 endpoints)
```
GET    /api/admin/testimonials      # List all testimonials
GET    /api/admin/testimonials/:id  # Get testimonial by ID
POST   /api/admin/testimonials      # Create testimonial
PUT    /api/admin/testimonials/:id  # Update testimonial
DELETE /api/admin/testimonials/:id  # Delete testimonial
```

### Admin Contacts (5 endpoints)
```
GET    /api/admin/contacts         # List all contacts
GET    /api/admin/contacts/export  # Export to CSV
GET    /api/admin/contacts/:id     # Get contact by ID
PATCH  /api/admin/contacts/:id/mark-as-read # Mark as read
DELETE /api/admin/contacts/:id     # Delete contact
```

### Admin Settings (4 endpoints)
```
GET    /api/admin/settings/about  # Get about settings
PUT    /api/admin/settings/about  # Update about settings
GET    /api/admin/settings/site   # Get site settings
PUT    /api/admin/settings/site   # Update site settings
```

### Public Endpoints (11+ endpoints)
```
GET    /api/posts               # List public posts
GET    /api/posts/:slug         # Get post by slug
GET    /api/projects            # List projects
GET    /api/projects/:slug      # Get project by slug
GET    /api/categories          # List categories
GET    /api/categories/:slug    # Get category by slug
GET    /api/awards              # List awards
GET    /api/gallery             # List galleries
GET    /api/testimonials        # List testimonials
POST   /api/contact             # Submit contact form
GET    /api/settings            # Get settings
GET    /api/health              # Health check
```

## API Response Format

### Success Response
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "Post Title",
    "slug": "post-title",
    "content": "...",
    "category": { "id": 1, "name": "Technology" },
    "created_at": "2025-10-16T10:00:00Z"
  },
  "message": "Post retrieved successfully"
}
```

### Pagination Response
```json
{
  "data": [...],
  "meta": {
    "current_page": 1,
    "last_page": 5,
    "per_page": 10,
    "total": 50
  },
  "links": {
    "first": "...",
    "last": "...",
    "prev": null,
    "next": "..."
  }
}
```

### Error Response
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed"
  }
}
```

## ğŸ§ª Testing

```bash
# Run all tests
php artisan test

# Run specific test file
php artisan test tests/Feature/PostTest.php

# With coverage
php artisan test --coverage

# Using Pest
./vendor/bin/pest --coverage
```

## ğŸ”’ Security

### Implemented Features
- âœ… CSRF Protection (middleware)
- âœ… XSS Protection (Eloquent escaping)
- âœ… SQL Injection Prevention (Eloquent ORM)
- âœ… Authentication (Sanctum tokens)
- âœ… Rate Limiting (contact form: 5 req/min)
- âœ… Input Validation (Form Requests)
- âœ… Password Hashing (Bcrypt)
- âœ… CORS Configuration

### Security Checklist
- [ ] Change database credentials in production
- [ ] Use environment variables for all secrets
- [ ] Enable HTTPS in production
- [ ] Set `APP_DEBUG=false` in production
- [ ] Run `composer audit` before deployment
- [ ] Configure proper CORS origins
- [ ] Set file permissions: `chmod 755 storage`

## ğŸ“Š Database Schema

### 17 Migrations (100% Complete)
- users, posts, blog_categories
- projects, awards, award_galleries
- galleries, testimonials, services
- contacts, newsletters, settings
- password_reset_tokens, failed_jobs, personal_access_tokens

### 13 Seeders (100% Complete)
- Generates test data for all models
- Run with: `php artisan db:seed`

## ğŸ”§ Common Commands

```bash
# Database
php artisan migrate                    # Run migrations
php artisan migrate:fresh --seed       # Fresh database
php artisan db:seed                    # Seed database

# Cache
php artisan cache:clear                # Clear cache
php artisan config:clear               # Clear config
php artisan route:clear                # Clear routes

# Development
php artisan tinker                     # Interactive shell
php artisan route:list                 # List all routes
php artisan make:controller ProjectController  # Create controller
```

## ğŸ“ˆ API Status (78% Complete)

### Completed Controllers (6/9)
- âœ… ProjectController - Full CRUD
- âœ… AwardController - Full CRUD + gallery relationships
- âœ… GalleryController - Full CRUD + bulk operations
- âœ… TestimonialController - Full CRUD
- âœ… ContactController - Read-only + export
- âœ… SettingsController - About & Site settings

### Pending Controllers (3/9)
- ğŸ”² PostController (Sprint 8 - COMPLETE)
- ğŸ”² CategoryController (Sprint 8 - COMPLETE)
- ğŸ”² AutomationController (Sprint 9)

### Form Requests (10+)
- âœ… StoreProjectRequest, UpdateProjectRequest
- âœ… StoreAwardRequest, UpdateAwardRequest
- âœ… StoreGalleryRequest, UpdateGalleryRequest
- âœ… StoreTestimonialRequest, UpdateTestimonialRequest
- âœ… UpdateAboutSettingsRequest, UpdateSiteSettingsRequest
- âœ… StorePostRequest, UpdatePostRequest
- âœ… StoreCategoryRequest, UpdateCategoryRequest

### API Resources (6+)
- âœ… PostResource, ProjectResource
- âœ… GalleryResource, AwardResource
- âœ… TestimonialResource, CategoryResource

## ğŸ“ Recent Updates

### Phase 6 Sprint 8 - Blog Management (October 15, 2025)

**âœ… Completed:**
- âœ… **PostController** - Full CRUD implementation
  - `indexForAdmin()` - List with search, filters, pagination
  - `showById($id)` - Get post for admin edit
  - `show($slug)` - Public post retrieval
  - `store()` - Create with image upload
  - `update($id)` - Update with image replacement
  - `destroy($id)` - Delete with file cleanup

- âœ… **CategoryController** - Full CRUD implementation
  - `indexForAdmin()` - Admin list
  - `index()` - Public list
  - `showById($id)` - Get for admin
  - `show($slug)` - Public retrieval
  - `store()` - Create category
  - `update($id)` - Update category
  - `destroy($id)` - Delete with validation

- âœ… **Form Validation**
  - StorePostRequest - Complete validation rules
  - UpdatePostRequest - Update validation
  - StoreCategoryRequest - Category validation
  - UpdateCategoryRequest - Category update validation

- âœ… **API Routes**
  - `/admin/posts` - All CRUD endpoints
  - `/admin/categories` - All CRUD endpoints

**Backend API:** 78% Complete â†’ Controllers 6/9 (67%)

**All Admin Features:** 8/8 (100%) âœ…

### Next Sprint: Automation API (n8n Integration)
- API tokens management
- Webhook triggers
- Bulk operations
- n8n workflow templates

---

**Framework**: Laravel 10.x
**PHP Version**: 8.2+
**Database**: MySQL 8.0 via XAMPP
**Last Updated**: October 16, 2025
**Status**: Production Ready (Sprint 8/12 - 67% Complete)

See [PROJECT_STATUS.md](../PROJECT_STATUS.md) for full progress details.
